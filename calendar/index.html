<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="js/timepicker/jquery.datetimepicker.css">
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/timepicker/jquery.datetimepicker.js"></script>
</head>

<body>
    我是主页主页主页
    <form id="addUser">
        <label>你的名字ID</label>
        <input type="text" name="userId" placeholder="请输入英文">

        <label>开始时间</label>
        <input type="text" name="time_begin" id="time_begin">
        <label>结束时间</label>
        <input type="text" name="time_end" id="time_end">
        <label>子状态</label>
        <input type="text" name="status_object" id="status_object">

        <input type="submit" id="submit">
    </form>
    <script type="text/javascript">
        var client = new WebSocket('ws://localhost:3000/');
        var data = {
            userId: "abcddd",
            time_begin: 2312312,
            time_end: 232312
        }
        client.onerror = function() {
            console.log('发生错误');
        };

        client.onopen = function() {
            console.log('websocket已连接');
        };

        client.onclose = function() {
            console.log('websocket已关闭');
        };

        client.onmessage = function(e) {
            console.log(e.data);
        };


        jQuery.prototype.serializeObject = function(must) {
            var obj = new Object();
            var flag = false;
            $.each(this.serializeArray(), function(index, param) {
                if (!(param.name in obj)) {
                    obj[param.name] = param.value || "";
                }
            });
            if (flag) {
                return false;
            }
            return obj;
        };

        //时间插件
        $('#time_begin').datetimepicker({
            format: 'Y-m-d h:m:s',
            //            timepicker: false,
            lang: 'ch'
        });
        $('#time_end').datetimepicker({
            format: 'Y-m-d h:m:s',
            //            timepicker: false,
            lang: 'ch'
        });
        $("#addUser").submit(function(eve) {
            eve.preventDefault();
            var data = $("#addUser").serializeObject();
            data.time_begin = (new Date(data.time_begin)).getTime();
            data.time_end = (new Date(data.time_end)).getTime();
            if (client.readyState === client.OPEN) {
                client.send(JSON.stringify(data));
            }
        })
    </script>

</body>

</html>